{% extends "travelpad/base.html" %}

{% block head %}
{% load staticfiles %}
<script src="{% static 'travelpad/js/message.js' %}" type="text/javascript"></script>
{% endblock %}


{% block content %}
<div class="feed" ng-controller="MessageController as msgCtrl">
	<div class="row">
		<aside class="col-md-2">
			{% include "travelpad/itinerary_nav.html" with feed_active='class="active"' %}	
		</aside>
		
		{% verbatim %} 
		<div class="col-md-10">
			<!-- Message form -->
			<form name="messageForm" ng-submit="messageForm.$valid && msgCtrl.addMessage()" novalidate>
				<fieldset class="form-group">
					<!-- <textarea ng-model="msgCtrl.newMessage.content" class="form-control" placeholder="What's on your mind?" title="content" required></textarea> -->
					<div class="input-group">
					<input ng-model="msgCtrl.newMessage.content" type="text" placeholder="What's on your mind?" class="form-control" name="content" autocomplete="off" required>
						<span class="input-group-btn">
							<input type="submit" value="Post" class="btn btn-success" ng-disabled="messageForm.$invalid">
						</span>
					</div>
				</fieldset>
			</form>
			<!-- Message list -->
			<div class="message-list">
				<div class="message-list-item" ng-repeat="message in msgCtrl.messages| orderBy:'-creation_time'">
				<h4>
					<img ng-src="{{message.created_by.photo}}" width="40px" height="40px">
					<a href="#">{{message.created_by.username}}</a>
					<span class="label label-default">{{message.creation_time | date:'medium'}}</span>
				</h4>
				<div class="well well-sm">
					<p>{{message.content}}</p>	
					<!-- Reply list -->	
					<div class="reply-list">
						<div class="reply-list-item" ng-repeat="reply in message.replies| orderBy:'creation_time'">
							<div class="media">
								<div class="media-left">
						      	  <img class="media-object" ng-src="{{reply.created_by.photo}}" width="30px" height="30px">
						  		</div>
						  		<div class="media-body">
						    		<h6 class="media-heading">
										{{reply.created_by.username}}
									<span class="label label-default">{{reply.creation_time | date:'medium'}}</span>
									</h6>
									<h6>{{reply.content}}</h6>
						  		</div>
							</div>
						</div>
						<form class="form-group" name="replyForm" ng-submit="replyForm.$valid && msgCtrl.addReply(message)" novalidate>
							<fieldset class="input-group">
						    	<input ng-model="message.newReply.content" type="text" placeholder="Write a reply..." class="form-control" name="content" autocomplete="off" required>
						       	<span class="input-group-btn">
								<input type="submit" value="Reply" class="btn btn-success" ng-disabled="replyForm.$invalid">
								</span>
							</fieldset>
						</form>
					</div> <!-- end of reply-list -->
				</div>
			</div> <!-- end of message-list-item -->
		</div> <!-- end of message-list -->
</div>
	{% endverbatim %}
{% endblock %}


