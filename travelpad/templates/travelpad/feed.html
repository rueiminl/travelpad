{% extends "travelpad/base.html" %}

{% block head %}
{% load staticfiles %}
<script src="{% static 'travelpad/js/message.js' %}" type="text/javascript"></script>
{% endblock %}

{% block nav %}
{% include "travelpad/nav.html" %}
{% endblock %}

{% block content %}
<div class="feed" ng-controller="MessageController as msgCtrl">
	<div class="row">
		<aside class="col-md-2">
			{% include "travelpad/itinerary_nav.html" with feed_active='class="active"' %}	
		</aside>
		
		{% verbatim %} 
		<div class="col-md-10">
			<!-- Message form -->
			<form name="messageForm" ng-submit="messageForm.$valid && msgCtrl.addMessage()" novalidate>
				<fieldset class="form-group">
					<!-- <textarea ng-model="msgCtrl.newMessage.content" class="form-control" placeholder="What's on your mind?" title="content" required></textarea> -->
					<div class="input-group">
					<input ng-model="msgCtrl.newMessage.content" type="text" placeholder="What's on your mind?" class="form-control" name="content" autocomplete="off" required>
						<span class="input-group-btn">
							<input type="submit" value="Post" class="btn btn-success" ng-disabled="messageForm.$invalid">
						</span>
					</div>
				</fieldset>
			</form>
			<!-- Message list -->
			<div class="message-list">
				<div class="message-list-item panel panel-default" ng-repeat="message in msgCtrl.messages| orderBy:'-creation_time'">
					<div class="panel-heading">
						<div class="media">
							<div class="media-left media-middle">
								<img class="img-circle" ng-src="{{message.created_by.photo}}" width="50px" height="50px">
							</div>
							<div class="media-body">
								<a href="#"><b>{{message.created_by.username}}</b></a></br>
								<!-- <small>{{message.creation_time | prettyDate }}</small> -->
								<small time="{{message.creation_time}}"></small>
							</div>
						</div> <!-- end of media -->
						<p>{{message.content}}</p>
					</div>
					<!-- Reply list -->	
					<div class="reply-list panel-body">
						<div class="reply-list-item" ng-repeat="reply in message.replies| orderBy:'creation_time'">
							<div class="media">
								<div class="media-left media-middle">
						      	  <img class="media-object img-circle" ng-src="{{reply.created_by.photo}}" width="40px" height="40px">
						  		</div>
						  		<div class="media-body">
						    		<h6 class="media-heading"><b>{{reply.created_by.username}}</b><span> {{reply.content}}</span></h6>
									<!-- <small>{{reply.creation_time | prettyDate}}</small>	 -->
									<small time="{{reply.creation_time}}"></small>							
						  		</div>
							</div> <!-- end of media -->
						</div>
						<form class="form-group" name="replyForm" ng-submit="replyForm.$valid && msgCtrl.addReply(message)" novalidate>
							<fieldset class="input-group">
						    	<input ng-model="message.newReply.content" type="text" placeholder="Write a reply..." class="form-control" name="content" autocomplete="off" required>
								<input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;">
							</fieldset>
						</form>
					</div> <!-- end of reply-list -->
				</div> <!-- end of message-list-item -->
			</div> <!-- end of message-list-item -->
		</div> <!-- end of message-list -->
</div>
	{% endverbatim %}
{% endblock %}


